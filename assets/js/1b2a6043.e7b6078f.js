"use strict";(self.webpackChunkwebsite_docs=self.webpackChunkwebsite_docs||[]).push([[7456],{7062:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"chaincode-deployment/k8s-builder","title":"Kubernetes chaincode builder","description":"Architecture","source":"@site/docs/chaincode-deployment/k8s-builder.md","sourceDirName":"chaincode-deployment","slug":"/chaincode-deployment/k8s-builder","permalink":"/bevel-operator-fabric/docs/chaincode-deployment/k8s-builder","draft":false,"unlisted":false,"editUrl":"https://github.com/hyperledger-bevel/bevel-operator-fabric/edit/master/website/docs/chaincode-deployment/k8s-builder.md","tags":[],"version":"current","frontMatter":{"id":"k8s-builder","title":"Kubernetes chaincode builder"},"sidebar":"mainSidebar","previous":{"title":"External chaincode as a service","permalink":"/bevel-operator-fabric/docs/chaincode-deployment/external-chaincode-as-a-service"},"next":{"title":"Installing chaincodes with the FabricChaincodeInstall CRD","permalink":"/bevel-operator-fabric/docs/chaincode-deployment/install-crd"}}');var i=r(4848),a=r(8453);const c={id:"k8s-builder",title:"Kubernetes chaincode builder"},l=void 0,s={},o=[{value:"Architecture",id:"architecture",level:2},{value:"Creating peers with external builder",id:"creating-peers-with-external-builder",level:2},{value:"Install chaincode",id:"install-chaincode",level:2}];function d(e){const n={code:"code",h2:"h2",img:"img",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,i.jsx)(n.p,{children:"In order to build the chaincode, you have to use an image that has a Kubernetes builder bundled with it."}),"\n",(0,i.jsx)(n.p,{children:"The following picture illustrates how the Kubernetes builder bundled with the previous images works:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:r(8788).A+"",width:"1700",height:"1260"})}),"\n",(0,i.jsx)(n.h2,{id:"creating-peers-with-external-builder",children:"Creating peers with external builder"}),"\n",(0,i.jsx)(n.p,{children:"To use the Kubernetes builder, you have to create a peer with the following command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"export PEER_IMAGE=quay.io/kfsoftware/fabric-peer\nexport PEER_VERSION=2.4.1-v0.0.3\nexport ORG=org1\nexport MSP_ORG=Org1MSP\nexport CA_NAME=ca-org1.default\nexport PEER_SECRET=peerpw\n\nkubectl hlf peer create --image=$PEER_IMAGE --version=$PEER_VERSION --storage-class=$STORAGE_CLASS --enroll-id=peer --mspid=$MSP_ORG \\\n        --enroll-pw=$PEER_SECRET --capacity=5Gi --name=$ORG-peer1 --ca-name=$CA_NAME --k8s-builder=true\n"})}),"\n",(0,i.jsx)(n.p,{children:"If the peer is already created, you need to change the following properties:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"external_chaincode_builder: true\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Add the following item to the ",(0,i.jsx)(n.code,{children:"externalBuilders"})," property in the ",(0,i.jsx)(n.code,{children:"spec"})," section:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"  - name: k8s-builder\n    path: /builders/golang\n    propagateEnvironment:\n    - CHAINCODE_SHARED_DIR\n    - FILE_SERVER_BASE_IP\n    - KUBERNETES_SERVICE_HOST\n    - KUBERNETES_SERVICE_PORT\n    - K8SCC_CFGFILE\n    - TMPDIR\n    - LD_LIBRARY_PATH\n    - LIBPATH\n    - PATH\n    - EXTERNAL_BUILDER_HTTP_PROXY\n    - EXTERNAL_BUILDER_HTTPS_PROXY\n    - EXTERNAL_BUILDER_NO_PROXY\n    - EXTERNAL_BUILDER_PEER_URL\n"})}),"\n",(0,i.jsx)(n.p,{children:"And finally, update the image and version to the following:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"  image: quay.io/kfsoftware/fabric-peer\n  tag: 2.4.1-v0.0.3\n"})}),"\n",(0,i.jsx)(n.h2,{id:"install-chaincode",children:"Install chaincode"}),"\n",(0,i.jsx)(n.p,{children:"Install chaincode using the Kubernetes builder:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl hlf chaincode install --path=./fixtures/chaincodes/fabcar/go \\\n    --config=org1.yaml --language=golang --label=fabcar --user=admin --peer=org1-peer0.default\n\n# this can take 3-4 minutes\n"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>l});var t=r(6540);const i={},a=t.createContext(i);function c(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),t.createElement(a.Provider,{value:n},e.children)}},8788:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/kubernetes_builder_chaincode-598ec114c69f3011bf80dde932d0e111.png"}}]);