"use strict";(self.webpackChunkwebsite_docs=self.webpackChunkwebsite_docs||[]).push([[1161],{7134:(e,r,i)=>{i.r(r),i.d(r,{assets:()=>o,contentTitle:()=>a,default:()=>p,frontMatter:()=>c,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"operator-guide/prometheus-metrics","title":"Prometheus Metrics","description":"The HLF Operator exposes several Prometheus metrics that can be used for monitoring and alerting on your Hyperledger Fabric network. These metrics provide insights into certificate expiration times and current system time.","source":"@site/docs/operator-guide/prometheus-metrics.md","sourceDirName":"operator-guide","slug":"/operator-guide/prometheus-metrics","permalink":"/bevel-operator-fabric/docs/operator-guide/prometheus-metrics","draft":false,"unlisted":false,"editUrl":"https://github.com/hyperledger-bevel/bevel-operator-fabric/edit/master/website/docs/operator-guide/prometheus-metrics.md","tags":[],"version":"current","frontMatter":{"id":"prometheus-metrics","title":"Prometheus Metrics"},"sidebar":"mainSidebar","previous":{"title":"Renew certificates","permalink":"/bevel-operator-fabric/docs/operator-guide/renew-certificates"},"next":{"title":"Istio set up","permalink":"/bevel-operator-fabric/docs/operator-guide/istio"}}');var n=i(4848),s=i(8453);const c={id:"prometheus-metrics",title:"Prometheus Metrics"},a="Prometheus Metrics",o={},l=[{value:"Available Metrics",id:"available-metrics",level:2},{value:"Certificate Expiration Metrics",id:"certificate-expiration-metrics",level:3},{value:"<code>hlf_operator_certificate_expiration_timestamp_seconds</code>",id:"hlf_operator_certificate_expiration_timestamp_seconds",level:4},{value:"System Time Metrics",id:"system-time-metrics",level:3},{value:"<code>hlf_operator_current_time_seconds</code>",id:"hlf_operator_current_time_seconds",level:4},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Monitoring Certificate Expiration",id:"monitoring-certificate-expiration",level:3},{value:"Alerting Rules",id:"alerting-rules",level:3},{value:"Grafana Dashboard Queries",id:"grafana-dashboard-queries",level:3},{value:"Enabling Metrics Collection",id:"enabling-metrics-collection",level:2},{value:"Metric Updates",id:"metric-updates",level:2}];function d(e){const r={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsx)(r.h1,{id:"prometheus-metrics",children:"Prometheus Metrics"})}),"\n",(0,n.jsx)(r.p,{children:"The HLF Operator exposes several Prometheus metrics that can be used for monitoring and alerting on your Hyperledger Fabric network. These metrics provide insights into certificate expiration times and current system time."}),"\n",(0,n.jsx)(r.h2,{id:"available-metrics",children:"Available Metrics"}),"\n",(0,n.jsx)(r.h3,{id:"certificate-expiration-metrics",children:"Certificate Expiration Metrics"}),"\n",(0,n.jsx)(r.h4,{id:"hlf_operator_certificate_expiration_timestamp_seconds",children:(0,n.jsx)(r.code,{children:"hlf_operator_certificate_expiration_timestamp_seconds"})}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Type:"})," Gauge Vector",(0,n.jsx)(r.br,{}),"\n",(0,n.jsx)(r.strong,{children:"Description:"})," The date after which the certificate expires, expressed as a Unix Epoch Time."]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Labels:"})}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"node_type"}),': Type of the Fabric node (e.g., "peer", "orderer", "ca")']}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"crt_type"}),': Type of certificate (e.g., "tls", "signcert", "cacert")']}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"namespace"}),": Kubernetes namespace where the resource is deployed"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"name"}),": Name of the Fabric resource"]}),"\n"]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Example:"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:'hlf_operator_certificate_expiration_timestamp_seconds{node_type="peer",crt_type="tls",namespace="hlf-network",name="peer0-org1"} 1735689600\n'})}),"\n",(0,n.jsx)(r.h3,{id:"system-time-metrics",children:"System Time Metrics"}),"\n",(0,n.jsx)(r.h4,{id:"hlf_operator_current_time_seconds",children:(0,n.jsx)(r.code,{children:"hlf_operator_current_time_seconds"})}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Type:"})," Gauge",(0,n.jsx)(r.br,{}),"\n",(0,n.jsx)(r.strong,{children:"Description:"})," The current time in Unix Epoch Time."]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Example:"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"hlf_operator_current_time_seconds 1735689600\n"})}),"\n",(0,n.jsx)(r.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,n.jsx)(r.h3,{id:"monitoring-certificate-expiration",children:"Monitoring Certificate Expiration"}),"\n",(0,n.jsx)(r.p,{children:"You can create Prometheus queries to monitor certificate expiration:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-promql",children:'# Get all certificates expiring within the next 30 days\nhlf_operator_certificate_expiration_timestamp_seconds - hlf_operator_current_time_seconds < 2592000\n\n# Get certificates expiring within the next 7 days\nhlf_operator_certificate_expiration_timestamp_seconds - hlf_operator_current_time_seconds < 604800\n\n# Get certificates by node type\nhlf_operator_certificate_expiration_timestamp_seconds{node_type="peer"}\n\n# Get TLS certificates specifically\nhlf_operator_certificate_expiration_timestamp_seconds{crt_type="tls"}\n'})}),"\n",(0,n.jsx)(r.h3,{id:"alerting-rules",children:"Alerting Rules"}),"\n",(0,n.jsx)(r.p,{children:"Here are some example Prometheus alerting rules you can use:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yaml",children:'groups:\n  - name: hlf-certificate-alerts\n    rules:\n      - alert: CertificateExpiringSoon\n        expr: (hlf_operator_certificate_expiration_timestamp_seconds - hlf_operator_current_time_seconds) < 604800\n        for: 5m\n        labels:\n          severity: warning\n        annotations:\n          summary: "Certificate expiring soon"\n          description: "Certificate for {{ $labels.node_type }} {{ $labels.name }} in namespace {{ $labels.namespace }} will expire in less than 7 days"\n\n      - alert: CertificateExpiringVerySoon\n        expr: (hlf_operator_certificate_expiration_timestamp_seconds - hlf_operator_current_time_seconds) < 86400\n        for: 5m\n        labels:\n          severity: critical\n        annotations:\n          summary: "Certificate expiring very soon"\n          description: "Certificate for {{ $labels.node_type }} {{ $labels.name }} in namespace {{ $labels.namespace }} will expire in less than 24 hours"\n'})}),"\n",(0,n.jsx)(r.h3,{id:"grafana-dashboard-queries",children:"Grafana Dashboard Queries"}),"\n",(0,n.jsx)(r.p,{children:"For Grafana dashboards, you can use these queries:"}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Certificate Expiration Timeline:"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-promql",children:"hlf_operator_certificate_expiration_timestamp_seconds\n"})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Days Until Expiration:"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-promql",children:"(hlf_operator_certificate_expiration_timestamp_seconds - hlf_operator_current_time_seconds) / 86400\n"})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Certificates by Node Type:"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-promql",children:"count by (node_type) (hlf_operator_certificate_expiration_timestamp_seconds)\n"})}),"\n",(0,n.jsx)(r.h2,{id:"enabling-metrics-collection",children:"Enabling Metrics Collection"}),"\n",(0,n.jsx)(r.p,{children:"To collect these metrics, ensure that:"}),"\n",(0,n.jsxs)(r.ol,{children:["\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"ServiceMonitor is enabled"})," in your Fabric resources:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yaml",children:"serviceMonitor:\n  enabled: true\n  interval: 10s\n  labels: {}\n  sampleLimit: 0\n  scrapeTimeout: 10s\n"})}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Prometheus Operator is installed"})," in your cluster to automatically discover and scrape the metrics."]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Metrics endpoint is accessible"})," on the HLF Operator service."]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"metric-updates",children:"Metric Updates"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"Certificate expiration metrics"})," are updated whenever certificates are processed or renewed"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"Current time metric"})," is updated regularly to provide a reference point for time-based calculations"]}),"\n"]}),"\n",(0,n.jsx)(r.p,{children:"These metrics help you maintain visibility into your Hyperledger Fabric network's certificate lifecycle and ensure timely certificate renewals to prevent service disruptions."})]})}function p(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},8453:(e,r,i)=>{i.d(r,{R:()=>c,x:()=>a});var t=i(6540);const n={},s=t.createContext(n);function c(e){const r=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:c(e.components),t.createElement(s.Provider,{value:r},e.children)}}}]);