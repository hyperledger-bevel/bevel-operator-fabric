"use strict";(self.webpackChunkwebsite_docs=self.webpackChunkwebsite_docs||[]).push([[103],{5027:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>o,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>d});var t=n(4848),c=n(8453);const i={id:"external-chaincode-as-a-service",title:"External chaincode as a service"},s=void 0,r={id:"chaincode-deployment/external-chaincode-as-a-service",title:"External chaincode as a service",description:"Fabric 2.0 enabled the ability to deploy chaincode as a service. This is a chaincode that runs on a remote machine, container, or baremetal, and the peer will connect to it.",source:"@site/docs/chaincode-deployment/external-chaincode-as-a-service.md",sourceDirName:"chaincode-deployment",slug:"/chaincode-deployment/external-chaincode-as-a-service",permalink:"/bevel-operator-fabric/docs/chaincode-deployment/external-chaincode-as-a-service",draft:!1,unlisted:!1,editUrl:"https://github.com/hyperledger-bevel/bevel-operator-fabric/edit/master/website/docs/chaincode-deployment/external-chaincode-as-a-service.md",tags:[],version:"current",frontMatter:{id:"external-chaincode-as-a-service",title:"External chaincode as a service"},sidebar:"mainSidebar",previous:{title:"Getting started",permalink:"/bevel-operator-fabric/docs/chaincode-deployment/getting-started"},next:{title:"Kubernetes chaincode builder",permalink:"/bevel-operator-fabric/docs/chaincode-deployment/k8s-builder"}},o={},d=[{value:"Step 1: Prepare a Docker image for the chaincode",id:"step-1-prepare-a-docker-image-for-the-chaincode",level:2},{value:"Step 2: Install the chaincode",id:"step-2-install-the-chaincode",level:2},{value:"Step 3: Deploy the chaincode",id:"step-3-deploy-the-chaincode",level:2}];function l(e){const a={a:"a",code:"code",h2:"h2",img:"img",p:"p",pre:"pre",...(0,c.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.p,{children:"Fabric 2.0 enabled the ability to deploy chaincode as a service. This is a chaincode that runs on a remote machine, container, or baremetal, and the peer will connect to it."}),"\n",(0,t.jsxs)(a.p,{children:["HLF-operator supports the installation of chaincode as a service, using the ",(0,t.jsx)(a.code,{children:"ccaas"})," external builder that Hyperledger Fabric supports out-of-the-box since the version ",(0,t.jsx)(a.code,{children:"2.4.1"})]}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.img,{alt:"External chaincode as a service",src:n(5884).A+"",width:"1700",height:"1260"})}),"\n",(0,t.jsx)(a.h2,{id:"step-1-prepare-a-docker-image-for-the-chaincode",children:"Step 1: Prepare a Docker image for the chaincode"}),"\n",(0,t.jsx)(a.p,{children:"To deploy the chaincode in Kubernetes, we need to prepare a Docker image that has the chaincode in it."}),"\n",(0,t.jsxs)(a.p,{children:["You can use the following code as a baseline:\n",(0,t.jsx)(a.a,{href:"https://github.com/hyperledger/fabric-samples/tree/main/chaincode/fabcar/external",children:"https://github.com/hyperledger/fabric-samples/tree/main/chaincode/fabcar/external"})]}),"\n",(0,t.jsxs)(a.p,{children:["It contains a ",(0,t.jsx)(a.code,{children:"Dockerfile"})," and a ",(0,t.jsx)(a.code,{children:"fabcar.go"}),", if you build that folder:"]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"docker build -t <username>/chaincode .\n"})}),"\n",(0,t.jsx)(a.p,{children:"And then push it to Docker Hub:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"docker push <username>/chaincode\n"})}),"\n",(0,t.jsx)(a.p,{children:"You will be able to deploy the chaincode in the step 3"}),"\n",(0,t.jsx)(a.h2,{id:"step-2-install-the-chaincode",children:"Step 2: Install the chaincode"}),"\n",(0,t.jsxs)(a.p,{children:["In this step we will install the chaincode using the ",(0,t.jsx)(a.code,{children:"ccaas"})," external builder, telling the address of the chaincode service where the chaincode will be deployed."]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:'# remove the code.tar.gz asset-transfer-basic-external.tgz if they exist\nrm code.tar.gz asset-transfer-basic-external.tgz\nexport CHAINCODE_NAME=asset\nexport CHAINCODE_LABEL=asset\ncat << METADATA-EOF > "metadata.json"\n{\n    "type": "ccaas",\n    "label": "${CHAINCODE_LABEL}"\n}\nMETADATA-EOF\n\ncat > "connection.json" <<CONN_EOF\n{\n  "address": "${CHAINCODE_NAME}:7052",\n  "dial_timeout": "10s",\n  "tls_required": false\n}\nCONN_EOF\n\ntar cfz code.tar.gz connection.json\ntar cfz asset-transfer-basic-external.tgz metadata.json code.tar.gz\nexport PACKAGE_ID=$(kubectl hlf chaincode calculatepackageid --path=asset-transfer-basic-external.tgz --language=node --label=$CHAINCODE_LABEL)\necho "PACKAGE_ID=$PACKAGE_ID"\n\nkubectl hlf chaincode install --path=./asset-transfer-basic-external.tgz \\\n    --config=org1.yaml --language=golang --label=$CHAINCODE_LABEL --user=admin --peer=org1-peer0.default\n\n# this can take 3-4 minutes\n'})}),"\n",(0,t.jsx)(a.h2,{id:"step-3-deploy-the-chaincode",children:"Step 3: Deploy the chaincode"}),"\n",(0,t.jsxs)(a.p,{children:["In this last step, we will deploy the chaincode using the ",(0,t.jsx)(a.code,{children:"ccaas"})," external builder, specifying the name of the chaincode, which must be the same as we specified in the previous step."]}),"\n",(0,t.jsx)(a.p,{children:"And we will also specify the image which you have pushed in the first step."}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"kubectl hlf externalchaincode sync --image=<username>/chaincode:latest \\\n    --name=$CHAINCODE_NAME \\\n    --namespace=default \\\n    --package-id=$PACKAGE_ID \\\n    --tls-required=false \\\n    --replicas=1\n"})})]})}function h(e={}){const{wrapper:a}={...(0,c.R)(),...e.components};return a?(0,t.jsx)(a,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},5884:(e,a,n)=>{n.d(a,{A:()=>t});const t=n.p+"assets/images/external_chaincode_as_a_service-556456d17367243fdfa997525540a93e.png"},8453:(e,a,n)=>{n.d(a,{R:()=>s,x:()=>r});var t=n(6540);const c={},i=t.createContext(c);function s(e){const a=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function r(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:s(e.components),t.createElement(i.Provider,{value:a},e.children)}}}]);